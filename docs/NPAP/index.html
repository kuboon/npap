<!DOCTYPE html>
<html lang="ja"><head><meta charset="utf-8"><link rel="stylesheet" href="/style/index.css"><meta name="viewport" content="width=device-width"><link rel="icon" href="data:image/svg+xml;,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xml%3Aspace%3D%22preserve%22%20viewBox%3D%220%200%201024%201024%22%3E%3Cg%20fill%3D%22%238f4c01%22%3E%3Cpath%20d%3D%22M545.269%201012.44c-10.212%207.12-21.461%2010.96-33.748%2011.51-12.286.54-23.216-3.15-32.79-11.1L330.818%20885.887c-9.254-8.218-13.802-17.806-13.642-28.763.159-10.957%204.866-20.408%2014.121-28.352l74.196-63.277-108.183-92.451c-9.254-7.944-13.802-17.395-13.642-28.352.159-10.957%204.867-20.545%2014.121-28.762l100.045-86.288c-65.739-27.119-116.48-62.867-152.221-107.243C209.871%20378.022%20192%20328.578%20192%20274.066c0-37.802%208.297-73.276%2024.892-106.421%2016.594-33.146%2039.491-62.319%2068.691-87.52%2029.199-25.202%2063.186-44.857%20101.959-58.964C426.316%207.054%20467.722%200%20511.761%200c44.677%200%2086.322%207.054%20124.936%2021.161%2038.614%2014.107%2072.6%2033.693%20101.96%2058.758%2029.359%2025.064%2052.256%2054.169%2068.691%2087.315C823.783%20200.379%20832%20235.99%20832%20274.066c0%2036.707-7.739%2071.427-23.216%20104.162-15.478%2032.734-37.417%2061.839-65.819%2087.314-28.402%2025.476-62.069%2045.61-101.002%2060.402v387.883c0%206.849-1.357%2013.902-4.069%2021.161-2.713%207.26-7.579%2013.492-14.6%2018.696l-78.025%2058.756zm-33.508-64.919%2053.134-45.199V478.28c37.337-7.122%2070.366-20.545%2099.087-40.267%2028.721-19.723%2051.139-43.692%2067.255-71.907%2016.116-28.215%2024.174-58.895%2024.174-92.04%200-28.763-6.303-55.676-18.908-80.741-12.606-25.064-29.998-47.115-52.177-66.153-22.179-19.039-48.028-33.968-77.547-44.788-29.518-10.82-61.191-16.23-95.018-16.23-44.677%200-85.445%209.313-122.304%2027.94-36.859%2018.628-66.138%2043.692-87.838%2075.194-21.701%2031.502-32.551%2066.428-32.551%20104.778%200%2032.598%208.217%2063.072%2024.652%2091.424%2016.435%2028.352%2039.571%2052.663%2069.409%2072.933%2029.838%2020.271%2064.702%2034.516%20104.593%2042.733v83.001L373.9%20645.103l101.481%2085.877v68.208l-67.973%2057.525%20104.353%2090.808z%22%2F%3E%3Cpath%20d%3D%22M569.625%20126.125c-41.467%200-77.707%2015.04-107%2044.437-29.273%2029.378-44.187%2065.646-44.188%20107.188%200%2041.962%2014.895%2078.477%2044.188%20107.875%2029.293%2029.398%2065.533%2044.5%20107%2044.5%2041.885%200%2078.311-15.081%20107.625-44.5%2029.293-29.398%2044.25-65.913%2044.25-107.875%200-42-14.95-78.436-44.313-107.625-29.313-29.14-65.736-44-107.562-44zm0%2059.375c26.214%200%2047.552%208.721%2065.687%2026.75%2018.087%2017.98%2026.813%2039.217%2026.813%2065.5%200%2026.321-8.782%2047.779-26.938%2066-18.135%2018.2-39.407%2027-65.562%2027-25.678%200-46.782-8.779-64.938-27-11.485-11.527-18.76-24.533-22.875-39.063%2010.058%207.46%2022.037%2011.938%2034.938%2011.938%2035.412%200%2064.125-32.649%2064.125-72.938%200-23.193-9.733-43.638-24.563-57%204.346-.575%208.679-1.187%2013.313-1.187z%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E" type="image/svg+xml"><meta property="og:title" content="NPAP: No Password All Protected"><meta property="og:description" content="パスワード不要！ 暗号鍵が埋め込まれたURLをブックマークしておくだけ"></head><body><header><span>NPAP<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 1024 1024"><path d="M545.269 1012.44c-10.212 7.12-21.461 10.96-33.748 11.51-12.286.54-23.216-3.15-32.79-11.1L330.818 885.887c-9.254-8.218-13.802-17.806-13.642-28.763.159-10.957 4.866-20.408 14.121-28.352l74.196-63.277-108.183-92.451c-9.254-7.944-13.802-17.395-13.642-28.352.159-10.957 4.867-20.545 14.121-28.762l100.045-86.288c-65.739-27.119-116.48-62.867-152.221-107.243C209.871 378.022 192 328.578 192 274.066c0-37.802 8.297-73.276 24.892-106.421 16.594-33.146 39.491-62.319 68.691-87.52 29.199-25.202 63.186-44.857 101.959-58.964C426.316 7.054 467.722 0 511.761 0c44.677 0 86.322 7.054 124.936 21.161 38.614 14.107 72.6 33.693 101.96 58.758 29.359 25.064 52.256 54.169 68.691 87.315C823.783 200.379 832 235.99 832 274.066c0 36.707-7.739 71.427-23.216 104.162-15.478 32.734-37.417 61.839-65.819 87.314-28.402 25.476-62.069 45.61-101.002 60.402v387.883c0 6.849-1.357 13.902-4.069 21.161-2.713 7.26-7.579 13.492-14.6 18.696l-78.025 58.756zm-33.508-64.919 53.134-45.199V478.28c37.337-7.122 70.366-20.545 99.087-40.267 28.721-19.723 51.139-43.692 67.255-71.907 16.116-28.215 24.174-58.895 24.174-92.04 0-28.763-6.303-55.676-18.908-80.741-12.606-25.064-29.998-47.115-52.177-66.153-22.179-19.039-48.028-33.968-77.547-44.788-29.518-10.82-61.191-16.23-95.018-16.23-44.677 0-85.445 9.313-122.304 27.94-36.859 18.628-66.138 43.692-87.838 75.194-21.701 31.502-32.551 66.428-32.551 104.778 0 32.598 8.217 63.072 24.652 91.424 16.435 28.352 39.571 52.663 69.409 72.933 29.838 20.271 64.702 34.516 104.593 42.733v83.001L373.9 645.103l101.481 85.877v68.208l-67.973 57.525 104.353 90.808z"></path><path d="M569.625 126.125c-41.467 0-77.707 15.04-107 44.437-29.273 29.378-44.187 65.646-44.188 107.188 0 41.962 14.895 78.477 44.188 107.875 29.293 29.398 65.533 44.5 107 44.5 41.885 0 78.311-15.081 107.625-44.5 29.293-29.398 44.25-65.913 44.25-107.875 0-42-14.95-78.436-44.313-107.625-29.313-29.14-65.736-44-107.562-44zm0 59.375c26.214 0 47.552 8.721 65.687 26.75 18.087 17.98 26.813 39.217 26.813 65.5 0 26.321-8.782 47.779-26.938 66-18.135 18.2-39.407 27-65.562 27-25.678 0-46.782-8.779-64.938-27-11.485-11.527-18.76-24.533-22.875-39.063 10.058 7.46 22.037 11.938 34.938 11.938 35.412 0 64.125-32.649 64.125-72.938 0-23.193-9.733-43.638-24.563-57 4.346-.575 8.679-1.187 13.313-1.187z"></path></svg></span><small>No&nbsp;Password All&nbsp;Protected</small></header><div id="app"></div><script type="module">var V=Object.defineProperty;var s=(r,t)=>V(r,"name",{value:t,configurable:!0});function P(){if(typeof Deno<"u")return null;if(typeof crypto>"u")return"crypto";let{subtle:r}=crypto;return r?r.generateKey?r.encrypt?r.decrypt?r.wrapKey?r.unwrapKey?r.importKey?r.exportKey?crypto.getRandomValues?null:"crypto.getRandomValues":"crypto.subtle.exportKey":"crypto.subtle.importKey":"crypto.subtle.unwrapKey":"crypto.subtle.wrapKey":"crypto.subtle.decrypt":"crypto.subtle.encrypt":"crypto.subtle.generateKey":"crypto.subtle"}s(P,"missingFeature");var y=window.crypto?.subtle,C={name:"RSA-OAEP",hash:{name:"SHA-256"}};async function B(){let r=await y.generateKey({modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),...C},!0,["wrapKey","unwrapKey"]),t=await y.exportKey("jwk",r.publicKey),n=await y.exportKey("jwk",r.privateKey);return{publicKey:t,privateKey:n}}s(B,"generateJwkPair");function h(r){return y.importKey("jwk",r,C,!1,r.key_ops)}s(h,"importKey");async function S(r,t){let n=await y.generateKey({name:"AES-CBC",length:256},!0,["encrypt","decrypt"]),o=crypto.getRandomValues(new Uint8Array(16)),i=await H(n,o,t),a=await y.wrapKey("raw",n,r,"RSA-OAEP");return{key:new Uint8Array(a),iv:o,encrypted:new Uint8Array(i)}}s(S,"encryptByPublicKey");var c=class extends Error{};s(c,"UnwrapKeyError");async function v(r,t){let{key:n,iv:o,encrypted:i}=t,a=await y.unwrapKey("raw",n,r,"RSA-OAEP","AES-CBC",!1,["decrypt"]).catch(p=>{throw new c});return $(a,o,i)}s(v,"decryptByPrivateKey");async function J(r){let{e:t,kty:n,n:o}=r,i=JSON.stringify({e:t,kty:n,n:o}),a=new TextEncoder().encode(i).buffer,p=await y.digest("SHA-256",a);return[...new Uint8Array(p)].map(l=>("0"+l.toString(16)).slice(-2))}s(J,"thumbprint");function H(r,t,n){return y.encrypt({name:"AES-CBC",iv:t},r,n)}s(H,"aesEncrypt");function $(r,t,n){return y.decrypt({name:"AES-CBC",iv:t},r,n)}s($,"aesDecrypt");var q={alg:"RSA-OAEP-256",e:"AQAB",ext:!1,kty:"RSA"},G=["d","dp","dq","n","p","q","qi"],X=s((r,t)=>{let n={};for(let o of t)r[o]&&(n[o]=r[o]);return n},"pick");function T(r){return X(r,G)}s(T,"minifyJwk");function K(r,t){return{key_ops:[t],...q,...r}}s(K,"fullifyToJwk");import{default as e}from"https://esm.sh/react@18";import{default as U}from"https://esm.sh/react-dom@18";import*as L from"https://esm.sh/@msgpack/msgpack@2.7.1";var{useRef:Q}=e;function g(){let r=Q(null);return e.createElement("main",{id:"instruction"},e.createElement("head",null,e.createElement("title",null,"NPAP 鍵生成ページ")),e.createElement("h1",null,"鍵生成ページ"),e.createElement("p",null,"受信者のお名前",e.createElement("br",null),e.createElement("input",{type:"text",ref:r,required:!0}),e.createElement("br",null),e.createElement("button",{onClick:s(()=>{let n=r.current.value;n.length!=0&&B().then(o=>{let i={receive_by:n,...T(o.privateKey)},a=new URLSearchParams(i);location.hash=a.toString()})},"generate")},"「秘密鍵ページ」を作成")),e.createElement("h2",null,"使い方"),e.createElement("p",null,"ファイルの受信者は、あらかじめ自分専用の「秘密鍵ページ」を作成し、お手元にブックマークを保存していつでも開けるようにしておきます。"),e.createElement("p",null,"「秘密鍵ページ」から「暗号化ページ」のURLが取得できるので、それをメールで相手に送ります。"),e.createElement("p",null,"ファイルの送信者は、「暗号化ページ」を開き、送りたいファイルを指定します。ファイルはどこへも送信されることなく、ブラウザ内で暗号化され、ダウンロードできます。"),e.createElement("p",null,"ファイルの送信者は、暗号化されたファイルをメールに添付して送ります。"),e.createElement("p",null,"ファイルの受信者は、暗号化されたファイルを受け取ったら「秘密鍵ページ」から元のファイルへ復号できます。"),e.createElement("h2",null,"なぜ安全なの？"),e.createElement("p",null,"公開鍵方式という暗号を使っています。「暗号化ページ」で暗号化されたファイルは、「秘密鍵ページ」のブックマークを知っている人のみが復号できます。"),e.createElement("p",null,"「秘密鍵ページ」は受信者の手元にあればよく、送信者には必要ありません。つまり、復号に必要な情報は一切ネットに流出しません。"),e.createElement("p",null,"NPAP の秘密鍵はURLの「#」以降のハッシュ文字列と呼ばれる部分に格納してあります。 ブラウザはこの情報をどこにも送りませんので、NPAP のサーバーにさえ秘密鍵は送信されません。"),e.createElement("h2",null,"鍵指紋とは"),e.createElement("p",null,"「秘密鍵ページ」から取得できる「暗号化ページ」には、同じ鍵指紋が表示されます。 両者の鍵指紋を検証することで、対応しているペアかどうかを確認できます。"))}s(g,"Instruction");var{decode:Y,encode:Z}=L,m=class extends Error{};s(m,"CryptoPackError");function N(r,t){return S(r,t).then(Z).catch(n=>{let o;throw n instanceof DOMException&&n.message.startsWith('The JWK member "n"')?o="暗号化ページのURLが破損しています。":(console.error(n),o="不明な暗号化エラーが発生: "+n.message),new m(o,n)})}s(N,"encryptBuffer");function j(r,t){let n=Y(t);return v(r,n).catch(o=>{let i;throw o instanceof RangeError&&(i="暗号化ファイルではありません"),o instanceof c?i="鍵が整合しません。暗号化ページと秘密鍵ページが対応しているかご確認ください。":(console.error(o),i="不明な復号エラーが発生: "+o.message),new m(i,o)})}s(j,"decryptBuffer");var{useEffect:z,useState:R}=e;function w({jwk:r}){let[t,n]=R("");return z(()=>{ee(r).then(n)}),e.createElement(e.Fragment,null,e.createElement("p",null,"鍵指紋:"),e.createElement("div",{className:"thumbprint"},t))}s(w,"Thumbprint");async function I(r,t,n){let o=await O(t);return N(r,o).then(i=>{let a=W(i,n);return b(a)}).catch(i=>{let a=t.name+": "+i.message;return b(a)})}s(I,"encryptFileAndGetResultNode");async function D(r,t){let n=await O(t);return j(r,n).then(o=>{let i=t.name.split(".").slice(0,-2).join("."),a=W(o,i);return b(a)}).catch(o=>{let i=t.name+": "+o.message;return b(i)})}s(D,"decryptFileAndGetResultNode");async function ee(r){let t=await J(r),n=[];for(let o of te(t,8))n.push(o.join(":"));return n.join(":"+String.fromCharCode(8203))}s(ee,"blockedThumbprint");function A({cryptoKey:r,children:t}){return r===!1?e.createElement("p",null,"URL が破損しています。保存されたURLを正しく開いているかご確認ください。"):e.createElement(e.Fragment,null,t)}s(A,"KeyIsValid");var re=0;function b(r){return e.createElement("p",{key:re++},r)}s(b,"P");var te=s(function*(r,t){for(let n=0,o=r.length;n<o;n+=t)yield r.slice(n,n+t)},"eachSlice"),O=s(r=>new Promise((t,n)=>{let o=new FileReader;o.onload=()=>t(o.result),o.onerror=n,o.readAsArrayBuffer(r)}),"readAsArrayBuffer");function ne(r){let t=new Blob([r],{type:"application/octet-stream"});return URL.createObjectURL(t)}s(ne,"arrayBufferToObjectUrl");function W(r,t){let n=ne(r);return e.createElement("a",{href:n,download:t,target:"_blank"},t)}s(W,"arrayBufferToDownloadAnchor");var{useCallback:oe,useEffect:se,useState:_}=e;function k({sendTo:r,pub:t}){let n=K(t,"wrapKey"),[o,i]=_([]),[a,p]=_();se(()=>{h(n).then(p).catch(()=>p(!1))},[t]);let f=oe(async l=>{if(!(a instanceof CryptoKey))return;let u=l.target.files?.[0];if(!u)return;let d=u.name+`.${r}.encrypt`,E=await I(a,u,d);i([E,...o])},[a,o]);return e.createElement("main",{id:"send"},e.createElement("head",null,e.createElement("title",null,r,"宛暗号化ページ:NPAP")),e.createElement("h1",null,"暗号化ページ"),e.createElement(A,{cryptoKey:a},e.createElement("p",null,"秘密鍵所有者: ",r),e.createElement("p",null,"このページから暗号化したファイルは、秘密鍵所有者だけが開けます。"),e.createElement(w,{jwk:n}),e.createElement("h2",null,"ファイルの暗号化"),e.createElement("input",{type:"file",onChange:f}),o))}s(k,"Send");var{useCallback:ie,useEffect:ae,useState:F}=e;function x({receiveBy:r,secrets:t}){let n=K(t,"unwrapKey"),o=`${location.origin}${location.pathname}#send_to=${encodeURI(r)}&n=${n.n}`,[i,a]=F([]),[p,f]=F();ae(()=>{h(n).then(u=>f(u)).catch(()=>f(!1))},[t]);let l=ie(async u=>{if(!(p instanceof CryptoKey))return;let d=u.target.files[0];if(!d)return;let E=await D(p,d);a([E,...i])},[p,i]);return e.createElement("main",{id:"receive"},e.createElement("head",null,e.createElement("title",null,r,"の秘密鍵ページ:NPAP")),e.createElement("h1",null,"秘密鍵ページ"),e.createElement(A,{cryptoKey:p},e.createElement("p",null,"所有者: ",r),e.createElement(w,{jwk:n}),e.createElement("p",null,"このページはあなた専用のものです。",e.createElement("br",null),"再生成は出来ませんので、 URL をブックマーク等に保存しておいてください。",e.createElement("br",null),"URL には秘密鍵が含まれています。大切に保管し、誰かにメール等で送ることはしないでください。"),e.createElement("h2",null,"「暗号化ページ」を送る"),e.createElement("p",null,"以下のURLをメール等で送信者に送付してください。"),e.createElement("input",{type:"text",value:o,readOnly:!0,style:{width:"100%"},onClick:u=>u.target.select()}),e.createElement("br",null),e.createElement("a",{href:o,target:"_blank"},"開いてみる"),e.createElement("h2",null,"ファイルの復号"),e.createElement("p",null,"「暗号化ページ」で暗号化されたファイルを受け取りましたら、以下から復号できます。"),e.createElement("p",null,"処理はネットを介さず、あなたのマシン上で処理されます。"),e.createElement("input",{type:"file",onChange:l}),i))}s(x,"Receive");var M=P();function pe(){if(M)return e.createElement("p",null,"お使いのブラウザはNPAPに対応しておりません。 セキュリティ確保のためにも最新のブラウザをご利用ください。",e.createElement("br",null),"不足機能: ",M);let r="1.1",[t,n]=e.useState(location.hash.slice(1));return addEventListener("hashchange",()=>n(location.hash.slice(1))),e.createElement("div",{id:"npap"},e.createElement(ye,{urlString:t}),e.createElement("footer",null,e.createElement("a",{href:"#",target:"_blank"},"鍵生成ページ"),e.createElement("a",{href:"https://npap.kbn.one",target:"_blank"},"NPAP Top"),e.createElement("span",null,"Version ",r)))}s(pe,"Npap");function ye({urlString:r}){let t=Object.fromEntries(new URLSearchParams(r));if(t.send_to){let{send_to:n,...o}=t;return e.createElement(k,{sendTo:n,pub:o})}if(t.receive_by){let{receive_by:n,...o}=t;return e.createElement(x,{receiveBy:n,secrets:o})}return e.createElement(g,null)}s(ye,"Pages");U.render(e.createElement(pe,null),document.getElementById("app"));
</script></body></html>